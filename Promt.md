# EcoBike PWA - Полный промпт разработки (Расширенная версия)

## Обзор проекта
Создать production-ready PWA приложение EcoBike - полноценная система обмена аккумуляторов велосипедов для рынка Казахстана с юридическими документами, системой ТО, договорами и полным документооборотом. Приложение должно устанавливаться на Android/iOS с полной офлайн функциональностью и реальными интеграциями.

## Основные требования

### Многоязычная поддержка
- **Языки**: Казахский (по умолчанию), Русский, Английский
- **Автоопределение языка**: Казахский как базовый, затем определение по `navigator.language` пользователя
- Переключатель языка в header с флагами стран
- Полная локализация UI включая:
  - Все текстовые элементы и юридические документы
  - Форматы дат (дд.мм.гггг для KZ/RU, mm/dd/yyyy для EN)
  - Форматы телефонов (+7 xxx xxx xx xx)
  - Валюта тенге (₸) с правильными разделителями
- RTL поддержка не требуется для казахского

### Система городов
- **Мультигород поддержка**: Алматы (по умолчанию), Астана, Шымкент, Актобе, Караганда, Павлодар, Усть-Каменогорск, Тараз
- Выбор города в настройках профиля
- Фильтрация станций по выбранному городу
- Геолокация для автоопределения ближайшего города
- Разные координаты и адреса для каждого города
- Региональные настройки ТО и сервисных центров

### Технологический стек
- **Frontend**: Vanilla JavaScript (ES2022), CSS3, HTML5
- **Backend**: Firebase (Auth, Firestore, Functions, Hosting, Messaging, Storage)
- **Карты**: OpenStreetMap с Leaflet.js
- **GPS отслеживание**: Traccar интеграция
- **Платежи**: Kaspi.kz платежный шлюз
- **QR сканер**: QuaggaJS для реального сканирования
- **Push уведомления**: Firebase Cloud Messaging + Service Worker
- **Документы**: PDF.js для просмотра, jsPDF для генерации
- **Подписи**: Canvas для электронной подписи

## Бизнес логика

### Тарифные планы
```
Start: 10 000₸/мес (~333₸/день)
- 2 замены аккумуляторов в день
- Бесплатное ТО на станции (раз в месяц)
- Техподдержка в приложении (9:00-18:00)
- Гарантия на батарею 6 месяцев
- Стандартный договор обслуживания

Standard: 15 000₸/мес (~500₸/день)
- 5 замен аккумуляторов в день
- Бесплатное выездное ТО (раз в 2 недели)
- GPS мониторинг включен
- Техподдержка в приложении (24/7)
- Гарантия на батарею 12 месяцев
- Расширенный договор обслуживания

Enterprise: 25 000₸/мес (~833₸/день)
- Безлимитные замены
- Приоритетное выездное ТО (по требованию)
- GPS мониторинг + аналитика
- Персональный менеджер
- Техподдержка 24/7 + телефон
- Гарантия на батарею 24 месяца
- VIP договор обслуживания

Аренда: 35 000₸/неделя (минимум 1 неделя)
- Тариф Start включен (2 замены/день)
- Оплата по неделям вперед
- Без залога и документов на велосипед
- Только ТО на станции
- Договор краткосрочной аренды
- Выкуп невозможен
- Гарантия на период аренды

Лизинг: 35 000₸/неделя × 12-52 недели
- Тариф Standard включен (5 замен/день)
- Срок: от 3 до 12 месяцев
- Выкуп: 55 000₸ после завершения
- GPS мониторинг включен
- Выездное ТО включено
- Полный лизинговый договор
- Страхование велосипеда
- Право досрочного выкупа


#### 1. Заставка и инициализация
```javascript
// Splash Screen + Onboarding
- Анимированный логотип EcoBike с прогресс-баром
- Определение языка системы (navigator.language || 'kz')
- Проверка обновлений приложения
- Геолокация для автоопределения города
- Загрузка критических данных (города, соглашения)
- Проверка авторизации пользователя
- Проверка принятых соглашений
- Переход к нужному экрану

// First Launch Onboarding (3-4 слайда)
Слайд 1: "Добро пожаловать в EcoBike"
- Анимация велосипеда с батареей
- "Быстрая замена батарей по всему городу"

Слайд 2: "Как это работает"
- Анимация QR сканирования
- "Сканируй → Меняй → Катайся"

Слайд 3: "Выбери свой тариф"
- Карточки тарифов с анимацией
- "От 2 замен в день до безлимита"

Слайд 4: "Договор и документы"
- Иконки документов
- "Вся отчетность в одном приложении"
```

#### 2. Экран авторизации
```javascript
// Enhanced Auth Screen
Header:
- Языковой переключатель (флаги: KZ/RU/EN)
- Кнопка "Помощь"

Main:
- Логотип и слоган на выбранном языке
- Поле ввода телефона с маской (+7 xxx xxx xx xx)
- Валидация в реальном времени
- Кнопка "Получить код" с лоадером
- Ссылка "Проблемы с получением SMS?"

OTP Screen:
- Код отправлен на +7 xxx xxx xx xx
- 6 полей для цифр с автофокусом
- Таймер повтора (60 секунд)
- Кнопка "Отправить повторно"
- Кнопка "Изменить номер"

Error Handling:
- Неверный номер
- Лимит SMS исчерпан
- Неверный код
- Заблокированный номер
```

#### 3. Согласие с пользовательскими соглашениями
```javascript
// Legal Agreements Screen
- Заголовок "Перед началом работы"
- Список соглашений для принятия:

1. Пользовательское соглашение
   - Краткое описание
   - Кнопка "Читать полностью"
   - Чекбокс "Принимаю условия"

2. Политика конфиденциальности
   - Краткое описание
   - Кнопка "Читать полностью"
   - Чекбокс "Согласен на обработку данных"

3. Правила безопасности
   - Краткое описание
   - Кнопка "Читать полностью"
   - Чекбокс "Ознакомлен с правилами"

Viewer для документов:
- Полноэкранный просмотр
- Возможность скачать PDF
- Навигация по разделам
- Поиск по тексту

Кнопка "Продолжить" (активна только если все принято)
```

#### 4. Выбор города и регистрация
```javascript
// City Selection + Registration
City Selection:
- Заголовок "Выберите ваш город"
- Сетка городов с иллюстрациями:
  * Алматы (горы Заилийского Алатау)
  * Астана (Байтерек)
  * Шымкент (традиционный орнамент)
  * Актобе (степные просторы)
  * Караганда (промышленные мотивы)
  * Павлодар (река Иртыш)
  * Усть-Каменогорск (горы)
  * Тараз (исторические мотивы)
- Кнопка "Определить по GPS"

Registration Form:
- ФИО (валидация на казахские/русские имена)
- ИИН с валидацией контрольной суммы
- дата рождения (18+ проверка)
- Email (опционально)
- Адрес проживания:
  * Район/микрорайон
  * Улица и дом
  * Квартира (опционально)

KYC Documents Upload:
- Фото удостоверения (лицевая сторона)
- Фото удостоверения (обратная сторона)
- Селфи с удостоверением
- распознование лице если не сложно
- Проверка качества фото
```

#### 5. Главный экран (Dashboard)
```javascript
// Enhanced Main Dashboard
Header:
- Приветствие "Сәлем, [Имя]!" с временем суток
- Иконка уведомлений с badge и цветовой индикацией
- Переключатель города (если есть доступ к нескольким)
- Кнопка службы поддержки

Status Cards (горизонтальная прокрутка):
1. Subscription Card:
   - Название и иконка тарифа
   - Прогресс-бар использования за день
   - "X из Y замен использовано"
   - Дни до окончания подписки
   - Мини-график активности за неделю

2. Current Bike Card:
   - Фото велосипеда или 3D модель
   - IMEI (ID) и серийный номер
   -Статус (В порядке/Требует ТО/Неисправность)
   - Кнопка "Найти на карте"

3. Maintenance Card:
   - Иконка технического состояния
   - Дата последнего ТО
   - Дата следующего планового ТО
   - Статус ("Отлично", "Хорошо", "Требует внимания")
   - Кнопка "Записаться на ТО"

Main Actions:
- Большая кнопка "Сканировать QR станции" (пульсирующая анимация)
- Дополнительные действия в виде сетки 2x2:
  * "Ближайшие станции" (с количеством доступных)
  * "История операций"
  * "Мои документы"
  * "Техподдержка"

Quick Stats:
- Пройдено км за месяц брать с tracar
- CO2 сэкономлено
- Количество замен за месяц
- Рейтинг эко-активности

News & Promotions:
- Карусель актуальных новостей
- Специальные предложения
- Уведомления от сервисного центра
```

#### 6. QR Сканер (Расширенный)
```javascript
// Advanced QR Scanner
Camera Interface:
- Полноэкранный видеопоток
- Анимированная рамка сканирования
- Кнопка включения/выключения вспышки
- Индикатор качества изображения
- Подсказки по наведению
- История последних сканирований

Pre-scan Validation:
- Проверка подписки пользователя
- Проверка дневных лимитов
- Проверка статуса аккумулятора
- Проверка состояния станции

Exchange Process:
1. Сканирование успешно → Информация о станции
2. Выбор ячейки из доступных
3. Фотофиксация текущего аккумулятора
4. Отчет о состоянии аккумулятора (повреждения, проблемы)
5. Подтверждение обмена
6. Процесс разблокировки ячеек
7. Получение заряженного аккумулятора
8. Финальная фотофиксация установленного аккумулятора
9. Электронный чек операции

Error Handling:
- Неверный QR код
- Станция недоступна
- Нет заряженных аккумуляторов
- Превышен лимит замен
- Технические неисправности
```

#### 7. Карта станций (Расширенная)
```javascript
// Comprehensive Stations Map
Map Features:
- OpenStreetMap с кастомными тайлами
- Кластеризация при масштабе города
- Цветовая индикация станций:
  * Зеленый: >5 заряженных аккумуляторов
  * Желтый: 1-5 заряженных аккумуляторов
  * Красный: нет заряженных аккумуляторов
  * Серый: станция не работает
  * Синий: ваша текущая станция

Filter Panel:
- "Все станции"
- "Доступные сейчас"
- "24/7 станции"
- "С навесом"
- "С инструментами"
- Радиус поиска (500м, 1км, 2км, 5км)

Station Details Popup:
- Название и адрес
- Доступно заряженных АКБ
- Расстояние и время до станции
- Кнопка "Построить маршрут"
- Кнопка "QR-код станции"

My Location:
- Автоопределение местоположения
- Компас при повороте карты
- Точность позиционирования
- Индикатор движения

Route Planning:
- Пешеходные маршруты до станции
- Велосипедные дорожки
- Учет пробок и препятствий
- Альтернативные маршруты
- Голосовая навигация
```

#### 8. Документы и договора
```javascript
// Documents & Contracts Hub
Categories:
1. Активные договора
   - Основной договор подписки/аренды/лизинга
   - Дополнительные соглашения
   - Страховые полисы
   - Статус каждого документа

2. Гарантийные документы
   - Гарантия на велосипед
   - Гарантия на обслуживание
   - Условия гарантийного ремонта

3. Технические документы
   - Акты приема-передачи
   - Протоколы технического осмотра
   - Справки о техническом состоянии
   - История ремонтов и замен

4. Финансовые документы
   - Чеки и квитанции
   - Счета на оплату
```
